<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<!-- Mirrored from localhost/dotclear/index.php?post/Example-2 by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 27 Jan 2013 10:35:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="ROBOTS" content="INDEX, FOLLOW" />
  
  <title>Point sample: 3D walls and filaments - DisPerSE - persistent structures identification</title>
  <meta name="description" lang="en" content="This tutorial follows the 2D discrete case example introduced in the previous section so you should probably read it first if you haven't done so yet. We will compute the" />
  <meta name="copyright" content="sousbie" />
  <meta name="author" content="thierry sousbie" />
  <meta name="date" scheme="W3CDTF" content="2320-05-09T06:59:00+01:00" />
  
  <link rel="schema.dc" href="http://purl.org/dc/elements/1.1/" />
  <meta name="dc.title" content="Point sample: 3D walls and filaments" />
  <meta name="dc.description" lang="en" content="This tutorial follows the 2D discrete case example introduced in the previous section so you should probably read it first if you haven't done so yet. We will compute the" />
  <meta name="dc.creator" content="thierry sousbie" />
  <meta name="dc.language" content="en" />
  <meta name="dc.publisher" content="thierry sousbie" />
  <meta name="dc.rights" content="sousbie" />
  <meta name="dc.date" scheme="W3CDTF" content="2320-05-09T06:59:00+01:00" />
  <meta name="dc.type" content="text" />
  <meta name="dc.format" content="text/html" />
  
  <link rel="top" href="indexd41d.html?" title="Home" />
  <link rel="contents" href="index888d.html?archive" title="Archives" />
  
  <link rel="next" href="index2d20.html?post/Example-1"
  title="Point sample: 2D voids and filaments" />
  
  <link rel="prev" href="index661f.html?post/skeleton-formats"
  title="Skeleton files" />
  
  <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../images/index4ca3.php?feed/atom" />
  
  <link rel="shortcut icon" href="../images/favicon.ico" />

<style type="text/css" media="screen">
@import url(../images/style.css);
</style>
<style type="text/css" media="print">
@import url(../images/print.css);
</style>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37686840-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
  
  <script type="text/javascript" src="../images/post.js"></script>
  <script type="text/javascript">
  //<![CDATA[
  var post_remember_str = 'Remember me on this blog';
  //]]>
  </script>

</head>

<body class="dc-post">
<div id="page">


<div id="top">
<!--
<h1><span><a href="http://localhost/dotclear/index.php?">DisPerSE - persistent structures identification</a></span></h1>
 -->

  </div>

<p id="prelude">
<a href="indexd41d.html?">Home</a> |
<a href="index888d.html?archive">Show all</a>
</p>

<!--
<ul id="nav-box">
2.
<li><a href="http://localhost/dotclear/index.php?">Accueil</a></li>
3.
<li><a href="http://localhost/dotclear/index.php?archive" title="Liste des mois de publication">Archives</a></li>
4.
<li><a href="http://localhost/dotclear/index.php?contact" title="Formulaire de contact">Me contacter</a></li>
5.
</ul>
 -->

<div id="wrapper">

<div id="main">
  <div id="content">
  
  <p id="navlinks">
 
  <a href="index2d20.html?post/Example-1"
  title="Point sample: 2D voids and filaments" class="prev">&#171; Point sample: 2D voids and filaments</a>
   <span>-</span> <a href="index661f.html?post/skeleton-formats"
  title="Skeleton files" class="next">Skeleton files &#187;</a>

<!--
  <a href="http://localhost/dotclear/index.php?post/skeleton-formats"
  title="Skeleton files" class="prev">&#171; Skeleton files</a>
  <span>-</span> <a href="http://localhost/dotclear/index.php?post/Example-1"
  title="Point sample: 2D voids and filaments" class="next">Point sample: 2D voids and filaments &#187;</a>
-->
  </p>
  
  <div id="p19" class="post">
    <b1 class="post-title">Point sample: 3D walls and filaments</b1>
    <!--
    <p class="post-info">By thierry sousbie    on Sunday, May  9 2320, 06:59        - <a href="http://localhost/dotclear/index.php?category/Quick-start">Tutorial</a>
        - <a href="http://localhost/dotclear/index.php?post/Example-2">Permalink</a>
    </p>
    -->
    
    
        
    <div class="post-content"><p>This tutorial follows the 2D discrete case example introduced in the <a href="index2d20.html?post/Example-1">previous section</a> so you should probably read it first if you haven't done so yet.
<br /><br />
We will compute the filaments and walls from the downsampled dark matter N-body simulation snapshot <em>${DISPERSE}/data/simu_32_id.gad</em>. The distribution has periodic boundary conditions and we therefore start by computing its Delaunay tessellation with the following command:
<br /><br /></p>
<div style="text-align: center; border: 1px dotted gray;">delaunay_3D simu_32_id.gad -periodic</div>


<p><br />
The program should output a file called <em>simu_32_id.gad.NDnet</em> that can be used directly with <a href="index4656.html?post/mse">mse</a> to compute the filaments and walls of the distribution. In 3D, walls are represented by the <a href="index959e.html?post/definitions">ascending 2-manifolds</a> that originate from critical points of critical index <em>1</em> so they can be computed with option <em><a href="index4656.html?post/mse#dumpmanifolds">-dumpManifolds</a> JE1a</em> (letter <em>E</em> stands for <em>Extended</em>, which means that the ascending 1-manifolds and ascending 0-manifolds  at the boundary of the walls will also be added, see option <em><a href="index4656.html?post/mse#dumpmanifolds">-dumpManifolds</a></em> of <a href="index4656.html?post/mse">mse</a>) .Note that by default, subsets of the walls that are common to several walls are merged together, so you may want to try <em>-dumpManifolds JP1a</em> instead if you are interested in studying the properties of individual walls. The filaments are computed with option <em><a href="index4656.html?post/mse#upskl">-upSkl</a></em> or <em><a href="index4656.html?post/mse#dumparcs">-dumparcs</a> U</em> which are equivalent. Using interactive mode to select a persistence threshold (use <em><a href="index4656.html?post/mse#nsig">-nsig</a> 3.5</em> instead of <em><a href="index4656.html?post/mse#interactive">-interactive</a></em> if <a href="index8707.html?post/pdview">pdview</a> could not compile on your computer), we run the following command:
<br /><br /></p>
<div style="text-align: center; border: 1px dotted gray;">mse simu_32_id.gad.NDnet -dumpManifolds JE1a -upSkl -interactive</div>


<p><br />
which after some quick computations, should display the following persistence diagram.
<br /><br />
<img src="../images/per_diag_3d.jpg" alt="per_diag_3D.jpg" style="display:block; margin:0 auto;" />
<br />
On this diagram, each type of pair is represented by a mark of different color : blue for minima/1-saddle, green for 1-saddle/2-saddle and red for 2-saddle/maxima. Note that the blue dots in the lower left corner stand for the voids in the distribution, so it is expected that we find only few of them compared to the red dots which represent collapsed structure (the simulation is <em>50 Mpc</em> large). Each point on the diagram representing a topological feature, we would like to select only those points that stand out of the general distribution in terms of persistence in order to keep only the most meaningful structures (the persistence selection threshold is set by clicking while holding <em>Ctrl</em> key). The diagram suggests that persistence threshold should be above <em>~3-sigmas</em> so we select a threshold of <em>~3.5 sigmas</em> and click on the <em>done</em> button to confirm the selection. The program continues and should output the filaments in file <em>simu_32_id.gad.NDnet_s3.52.up.NDskl</em> and the walls in file <em>simu_32_id.gad.NDnet_s3.52_manifolds_JE1a.NDnet</em>.
<br /><br />
It is instructive at that point to read <a href="index4656.html?post/mse">mse</a> output, and in particular the following section :
<br /><br /></p>

<pre>****** Simplifying complex ******
Starting Morse-Smale complex simplification.
Computing persistence pairs ... SKIPPED.
Sampling noise level was set to 3.5-sigma.
Cancelling pairs with persistance ratio &lt; [2.66e+00,3.14e+00,4.42e+01].
   Tagging arcs ... done.
   Cancelling pairs (smart) ... (4140 rem.)
done.
   Cancellation took 0.10s (4140 canceled, 1 conflicts, 10 loops).</pre>

<p><br /></p>


<p>what <em>mse</em> tells us here is that it successfully removed <em>4140</em> persistence pairs, but was not able to cancel <em>11</em> more although their persistence was lower than the threshold. The <em>10 loops</em> represent persistence pairs that were connected by more than one arc at the moment of their cancellation. Topologically speaking, their cancellation is not a valid operation as it would result in a discrete gradient loop (integral lines cannot form loops in <a href="index1f6e.html?post/general-concepts">Morse-theory</a>). Note that the existence of non-cancellable pairs is not a bug of DisPerSE but rather a feature of Morse theory. However, not cancelling them may result in a few spurious non-significant pieces of filaments remaining in the ouput file (this is very problematic though as the impact on the identified filaments is very small in general) so one can use option <em><a href="index4656.html?post/mse#forceloops">-forceLoops</a></em> to remove them anyway (which is perfectly fine if your goal is only to identify structures). Using this option will also solve the <em>1 conflict</em> identified by mse, as conflicts are the result of a non-cancellable pair blocking the cancellation of a valid cancellable pair.
<br /><br />
We can now rerun <em>mse</em> while skipping the computations by loading the backup file <em>simu_32_id.gad.NDnet.MSC</em> that mse generated on the previous run with option <em><a href="index4656.html?post/mse#loadmsc">-loadMSC</a></em>:
<br /><br /></p>
<div style="text-align: center; border: 1px dotted gray;">mse simu_32_id.gad.NDnet -dumpManifolds JE1a -upSkl -forceLoops -loadMSC simu_32_id.gad.NDnet.MSC  -nsig 3.52</div>


<p><br />
and the ouput should contain the following line:
<br /><br /></p>

<pre>   Cancellation took 0.10s (4151 canceled, 0 conflicts, 11 forced loops).</pre>

<p><br />
indicating that all the <em>4151</em> non persistent pairs could be cancelled.
<br /><br />
We can now smooth and convert the resulting files to a more portable format:
<br /><br /></p>

<pre>skelconv simu_32_id.gad.NDnet_s3.52.up.NDskl -smooth 10 -to vtp
netconv simu_32_id.gad.NDnet -to vtu
netconv simu_32_id.gad.NDnet_s3.52_manifolds_JE1a.NDnet -smooth 10 -to vtu</pre>

<p><br /><a name="walls"></a>
and visualize the result with <a href="http://www.paraview.org/" title="paraview">paraview</a>. The configuration file <em>${DISPERSE}/data/simu_32_per.pvsm</em> can be directly loaded in paraview (<em>File-&gt;Load State</em>) to make the following plot: (note that it is a bit tricky to deal with periodic boundary conditions when visualizing, clipping the boundaries is usually the easiest way)
<br /><br />
<img src="../images/simu_3d_result_small.jpg" alt="simu_3D_result_small.jpg" style="display:block; margin:0 auto;" />
<br /><br />
<strong>Note</strong>: contrary to the previous example where we computed 2D voids (see <a href="index2d20.html?post/Example-1#voids">here</a>), it is problematic in this case to identify each individual wall and paint it with a specific color. Indeed, contrary to voids, the 2-manifolds that represent walls can overlap, and so a unique <em><a href="index9cca.html?post/networks#source">source_index</a></em> representing the critical point from which each wall originates cannot be assigned to each simplex (i.e. in that case, triangle). A solution to this problem would have been to specify that we wanted identical simplices to be stored as many times as they appear in different walls even though they are the same. This could have been achieved with flag <em>P</em> of option <em><a href="index4656.html?post/mse#dumpmanifolds">-dumpManifolds</a></em> in <em>mse</em>:
<br /><br /></p>
<div style="text-align: center; border: 1px dotted gray;">mse simu_32_id.gad.NDnet -dumpManifolds JEP1a -upSkl -forceLoops -loadMSC simu_32_id.gad.NDnet.MSC  -nsig 3.52</div>


<p><br />
As a result, the output file is larger, but it would also allow cross-linking the information contained in the geometry of the walls and that in the skeleton files or persistence pairs network (see this <a href="index2d20.html?post/Example-1#voids">note</a>).</p></div>

      </div>

  

    
  
    
    
    </div>
</div> <!-- End #main -->

<div id="sidebar">
  <div id="blognav">
    <div class="categories"><ul><li><a href="index1694.html?category/Download">Download</a></li><li><a href="indexba87.html?category/Install">Install</a></li><li><a href="index3c4a.html?category/Overview">Overview</a></li><li><a href="index4559.html?category/Terminology">Terminology</a></li><li><a href="index4f3e.html?category/Manual">Manual</a></li><li class="category-current"><a href="index55a0.html?category/Quick-start">Tutorial</a></li><li><a href="index3333.html?category/Skeleton-I-O">Skeleton data</a></li><li><a href="indexe2a5.html?category/Network-I-O">Network data</a></li><li><a href="indexc777.html?category/Field-I-O">Field data</a></li><li><a href="indexdc31.html?category/References">Contact &amp; References</a></li></ul></div>  </div> <!-- End #blognav -->
   ____________________
  <div id="blogextra">
        <a href="index55a0.html?category/Quick-start">&#94; Tutorial</a></br>
    <a href="index2d20.html?post/Example-1">&#171; Point sample: 2D voids and filaments</a></br>
    <a href="index661f.html?post/skeleton-formats">&#187; Skeleton files</a></br>
  </div> <!-- End #blogextra -->
</div>

</div> <!-- End #wrapper -->

<div id="footer">
  <p>Powered by <a href="http://www.dotclear.net/">DotClear</a> - Contact: sousbie<em>(AT)</em>iap<em>.</em>fr . </p>
</div>
</div> <!-- End #page -->
</body>

<!-- Mirrored from localhost/dotclear/index.php?post/Example-2 by HTTrack Website Copier/3.x [XR&CO'2010], Sun, 27 Jan 2013 10:35:36 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8"><!-- /Added by HTTrack -->
</html>
